{{extend 'layout.html'}}

<!-- widget grid -->
<section id="widget-grid" class="">
<!-- row -->
<div class="row">
    <article class="col-sm-12">
    <!-- new widget -->
    <div class="jarviswidget" id="wid-id-0" data-widget-togglebutton="false" data-widget-editbutton="false" data-widget-fullscreenbutton="false" data-widget-colorbutton="false" data-widget-deletebutton="false">
        <!-- widget options:
        usage: <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false">
            data-widget-colorbutton="false"
            data-widget-editbutton="false"
            data-widget-togglebutton="false"
            data-widget-deletebutton="false"
            data-widget-fullscreenbutton="false"
            data-widget-custombutton="false"
            data-widget-collapsed="true"
            data-widget-sortable="false"
            -->
            <header>
            <span class="widget-icon"> <i class="fa fa-building txt-color-darken"></i> </span>
            <h2>
                {{if session.auth:}}
                Bienvenido: {{=auth.user['first_name'] + ' ' + auth.user['last_name']}}
                {{else:}}
                Sesión no iniciada.
                {{pass}}
            </h2>
            <ul class="nav nav-tabs pull-right in" id="myTab">
                <li class="active">
                <a data-toggle="tab" href="#s1"><i class="fa fa-bar-chart-o"></i> <span class="hidden-mobile hidden-tablet">Listado</span></a>
                </li>
            </ul>
            </header>
            <!-- widget div-->
            <div class="no-padding">
                <!-- widget edit box -->
                <div class="jarviswidget-editbox">
                    test
                </div>
                <!-- end widget edit box -->
                <div class="widget-body">
                    <!-- content -->
                    <div id="myTabContent" class="tab-content">
                        <div class="tab-pane fade active in padding-10 no-padding-bottom" id="s1">
                            <div class="padding-10">
                                <ul id="expList">

                                    {{#if not session.instancias:}}

                                        {{if session.auth:}}

                                            {{if mias:}}
                                                <strong>Empresas creadas por ti:</strong><br>
                                                {{for m in mias:}}
                                                    {{=A(m.razon_social, _href=URL('cc_empresa', 'index', args=m.id))}} |
                                                    {{=A('Eliminar', _id=m.id, _class='eliminar-empresa')}} |
                                                    {{=A('Compartir', _id=m.id, _class='invitar')}} |
                                                    <br>
                                                {{pass}}
                                            {{pass}}

                                            {{if compartidas:}}
                                                <strong>Empresas compartidas contigo:</strong><br>
                                                {{for c in compartidas:}}
                                                    {{=A(c.razon_social, _href=URL('cc_empresa', 'index', args=c.id))}}
                                                {{pass}}
                                            {{pass}}

                                        {{else:}}
                                        Sesión no iniciada.
                                        {{pass}}
                                        
                                    {{#else:}}
                                        <br>Se está editando la empresa {{=session.instancias}}
                                        {{#=A('¿Desea salir?', _href=URL('cc_empresa', 'index', args=0))}}
                                    {{#pass}}

                                </ul>
                            </div>
                        </div>
                        <!-- end s1 tab pane -->
                    </div>
                    <!-- end content -->
                </div>
            </div>
            <!-- end widget div -->
        </div>
        <!-- end widget -->
        </article>
    </div>
    <!-- end row -->
    </section>
    <!-- end widget grid -->

<link href="{{=URL('static', 'css/tabs.css')}}" rel="stylesheet">

<div id="modal_invitar" class="modalmask">
    <div class="modalbox movedown">
        <a href="#close" title="Cerrar" class="close">X</a>
        <h2>Enviar invitación</h2>
        <div id="form_invitar">
        </div>
    </div>
</div>

<script>

    $(document).ready(function(){

        /* Enviar email de invitación */
        $('.invitar').click(function(e) {
            e.preventDefault();
            window.location.href = '#modal_invitar';
            $("#form_invitar").load("{{=URL('empresa', 'invitar')}}");
        });

        /* Eliminar empresa */
        $('.eliminar-empresa').click(function(e) {
            e.preventDefault();

            id = $(this).attr('id');

            $.ajax({
                type: "post",
                url: "{{=URL('empresa', 'eliminar')}}",
                data: {id: id},
                success: function (response) {
                    console.log('good');
                    location.reload();
                },
                error: function (response) {
                    console.log('bad');
                },
            });
        });

        /* Compartir empresa */
        /*
        $('.compartir-empresa').click(function(e) {
            e.preventDefault();

            empresa_id = $(this).attr('id');
            usuario_id = 3;

            $.ajax({
                type: "post",
                url: "{{=URL('empresa', 'compartir')}}",
                data: {empresa_id: empresa_id, usuario_id:usuario_id},
                success: function (response) {
                    console.log('good');
                    location.reload();
                },
                error: function (response) {
                    console.log('bad');
                },
            });
        });
        */

    });
</script>
