{{extend 'layout.html'}}

<div id='content'>
    <div class='well'>
        {{if session.auth:}}
            <div class='row'>
                <h1 class="page-title txt-color-blueDark">
                    Bienvenido {{=auth.user['first_name'] + ' ' + auth.user['last_name']}}
                </h1>
            </div>
            {{if mias:}}
            <div class='row'>
                <header role="heading">
                    <h2>Tu(s) empresa(s)</h2>
                </header>
                {{for m in mias:}}
                <div class="col-sm-4 col-md-2">
                    <div class="btn-box">
                        <a href="{{=URL('cc_empresa', 'index', args=m.id)}}">
                            <img src="{{=URL('static','images/logo-o.png')}}">
                        </a>
                        <div class="btn-group">
                            <a class="dropdown-toggle" data-toggle="dropdown">
                                <h4>{{=m.razon_social}}
                                <span class="caret"> </span></h4>
                            </a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="{{=URL('cc_empresa', 'index', args=m.id)}}" class="btn btn-primary" role="button">Entrar
                                    </a>
                                </li>
                                <li>
                                    <a id='{{=m.id}}' data-nombre='{{=m.razon_social}}' class="btn btn-danger eliminar-empresa" role="button" href="javascript:void();" >Eliminar</a>
                                </li>
                            </ul>
                        </div>
                    </div><!--btn box-->
                </div><!--fin col-->
                {{pass}}
            </div><!--fin row-->
            {{pass}}
            {{if compartidas:}}
            <div class='row'>
                <header role="heading">
                    <h2>Empresas compartidas contigo</h2>
                </header>
                {{for c in compartidas:}}
                <div class="col-sm-4 col-md-2">
                    <div class="btn-box">
                        <a href="{{=URL('cc_empresa', 'index', args=c.id)}}">
                            <img src="{{=URL('static','images/logo-o.png')}}">
                        </a>
                        <div class="btn-group">
                            <a class="dropdown-toggle" data-toggle="dropdown">
                                <h4>{{=c.razon_social}}
                                <span class="caret"> </span></h4>
                            </a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="{{=URL('cc_empresa', 'index', args=c.id)}}" class="btn btn-primary" role="button">Entrar
                                    </a>
                                </li>
                                <li>
                                    <a id='{{=c.id}}' data-nombre='{{=c.razon_social}}' class="btn btn-danger" role="button" href="javascript:void();" >Eliminar</a>
                                </li>
                            </ul>
                        </div>
                    </div><!--btn box-->
                </div><!--fin col-->
                {{pass}}
            </div>
            {{pass}}
        {{else:}}
            <div class='row'>
                <h1 class="page-title txt-color-blueDark">
                    <span>No has iniciado sesión</span>
                </h1>
                <a class='btn btn-primary' href="{{=URL('default','login')}}">Iniciar sesión</a>
            </div><!--fin row-->
        {{pass}}
    </div><!--fin well-->
</div><!--content-->
<style>
    .dropdown-toggle{
        color: #22262E;
        text-decoration: none;
    }
    .dropdown-toggle:hover{
        text-decoration: none;
        cursor: pointer;
    }
    .dropdown-menu{
        min-width: 0px;
    }
    .dropdown-menu > li > a {
        color: #FFFFFF;
    }
    .dropdown-menu > li > a.btn-danger:hover {
        background-color: #D2322D;
        border-color: #d43f3a;
    }
    .btn-box{
        border: 1px solid #bbbbbb;
        background: #cccccc;
        background: -webkit-gradient(linear, left top, left bottom, from(#eeeeee), to(#cccccc));
        background: -webkit-linear-gradient(top, #eeeeee, #cccccc);
        background: -moz-linear-gradient(top, #eeeeee, #cccccc);
        background: -ms-linear-gradient(top, #eeeeee, #cccccc);
        background: -o-linear-gradient(top, #eeeeee, #cccccc);
        color: #22262e;
        padding: 10px;
    }
    .btn-box > a {
        text-decoration: none;
    }
    .btn-box > a:hover{
        text-decoration: none;
    }
    .btn-box > a > img:hover{
        cursor: pointer;
        opacity: 0.5;
    }
</style>
<script>
    $(document).ready(function(){
        $('.btn-box').click(function(){
            console.log(this);
        });
        $('.btn-group').click(function(){
            console.log(this);
        });
        $('.eliminar-empresa').click(function(e) {
            id = $(this).attr('id');
            nombre = $(this).data('nombre');
            $.SmartMessageBox({
                    title : "Eliminar empresa " + nombre,
                    content : "¿Estas seguro de eliminar esta empresa?",
                    buttons : "[Cancelar][Eliminar]",
                }, function(ButtonPress, Value) {
                    if (ButtonPress == "Eliminar") {

                        $.ajax({
                            type: "post",
                            url: "{{=URL('cc_empresa', 'eliminar_empresa')}}",
                            data: {id: id},
                            success: function (response) {
                                console.log('good');
                                location.reload();
                            },
                            error: function (response) {
                                console.log('bad');
                            },
                        });
                        return 0;
                    }
                });
            e.preventDefault();
        });
    });
</script>
