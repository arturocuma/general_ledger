{{extend 'layout.html'}}

<style>

    tr.fila-final td {
        padding: 1.2em 0;
        font-weight: bold;
    }

    .rojo {
        color: red;
    }

    .verde {
        color: green;
    }

</style>

				<!-- widget grid -->
				<section id="widget-grid" class="">
					<!-- row -->
					<div class="row">
						<!-- NEW WIDGET START -->
						<article class="col-sm-12 col-md-12 col-lg-12">
				
							<!-- Widget ID (each widget will need unique ID)-->
							<div class="jarviswidget" id="wid-id-2" data-widget-editbutton="false" data-widget-deletebutton="false">
								<!-- widget options:
								usage: <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false">
				
								data-widget-colorbutton="false"
								data-widget-editbutton="false"
								data-widget-togglebutton="false"
								data-widget-deletebutton="false"
								data-widget-fullscreenbutton="false"
								data-widget-custombutton="false"
								data-widget-collapsed="true"
								data-widget-sortable="false"
								-->

								<header>
									<h2>Configuración Inicial de Empresa</h2>
								</header>
				
								<!-- widget div-->
								<div>
				
									<!-- widget edit box -->
									<div class="jarviswidget-editbox">
										<!-- This area used as dropdown edit box -->
				
									</div>
									<!-- end widget edit box -->
				
									<!-- widget content -->
									<div class="widget-body fuelux">
				
										<div class="wizard">
											<ul class="steps">
												<li data-target="#step1" class="active">
													<span class="badge badge-info">1</span>Paso 1<span class="chevron"></span>
												</li>
												<li data-target="#step2">
													<span class="badge">2</span>Paso 2<span class="chevron"></span>
												</li>
												<li data-target="#step3">
													<span class="badge">3</span>Paso 3<span class="chevron"></span>
											</ul>
											<div class="actions">
												<button type="button" class="btn btn-sm btn-primary btn-prev">
													<i class="fa fa-arrow-left"></i>Anterior
												</button>
												<button type="button" class="btn btn-sm btn-success btn-next" data-last="Terminar">
													Siguiente<i class="fa fa-arrow-right"></i>
												</button>
											</div>
										</div>
                                        
										<div class="step-content">
				
                                            <form class="form-horizontal" action="{{=URL('empresa_wizard')}}" 
                                                id='empresa' method='post' enctype="multipart/form-data">

												<div class="step-pane active" id="step1">
													<h3><strong>Dirección</strong> </h3>
                                                        <fieldset>

                                                        <div class='row'>
                                                            <div class='col-md-3'><label>{{=form.custom.label.razon_social}}</label></div>
                                                            <div class='col-md-5'>
                                                                {{=form.custom.widget.razon_social}}
                                                            </div>
                                                            <div class='col-md-3 razon_social'></div>
                                                        </div>
                                                        <div class='row'>
                                                            <div class='col-md-3'><label>{{=form.custom.label.nombre_comercial}}</label></div>
                                                            <div class='col-md-5'>
                                                                {{=form.custom.widget.nombre_comercial}}
                                                            </div>
                                                        </div>
                                                        <div class='row'>
                                                            <div class='col-lg-3'><label>{{=form.custom.label.pais_id}}</label></div>
                                                            <div class='col-lg-5'>
                                                                <select id='no_table_pais_id' name='pais_id'>
                                                                    <option value="">TODO</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class='row'>
                                                            <div class='col-md-3'><label>{{=form.custom.label.estado_id}}</label></div>
                                                            <div class='col-md-5'>
                                                                <select id='no_table_estado_id' name='estado_id'>
                                                                    <option value="">TODO</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class='row'>
                                                            <div class='col-md-3'><label>{{=form.custom.label.municipio_id}}</label></div>
                                                            <div class='col-md-5'>
                                                                <select id='no_table_municipio_id' name='municipio_id'>
                                                                    <option value="">TODO</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class='row'>
                                                            <div class='col-md-3'><label>{{=form.custom.label.localidad_id}}</label></div>
                                                            <div class='col-md-5'>
                                                                <select id='no_table_localidad_id' name='localidad_id'>
                                                                    <option value="">TODO</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class='row'>
                                                            <div class='col-md-3'><label>{{=form.custom.label.dir_calle}}</label></div>
                                                            <div class='col-md-5'>
                                                                {{=form.custom.widget.dir_calle}}
                                                            </div>
                                                        </div>
                                                        <div class='row'>
                                                            <div class='col-md-3'><label>{{=form.custom.label.dir_num_ext}}</label></div>
                                                            <div class='col-md-5'>
                                                                {{=form.custom.widget.dir_num_ext}}
                                                            </div>
                                                        </div>
                                                        <div class='row'>
                                                            <div class='col-md-3'><label>{{=form.custom.label.dir_num_int}}</label></div>
                                                            <div class='col-md-5'>
                                                                <input id="_no_table_dir_num_int" class="string" 
                                                                type="text" value="" name="dir_num_int">
                                                                {{#=form.custom.widget.dir_num_int}}
                                                            </div>
                                                        </div>
                                                        <div class='row'>
                                                            <div class='col-md-3'><label>{{=form.custom.label.dir_cp}}</label></div>
                                                            <div class='col-md-5'>
                                                                {{=form.custom.widget.dir_cp}}
                                                            </div>
                                                            <div class='col-md-3 codigo_postal'></div>
                                                        </div>
                                                    </fieldset>
												</div>
				
												<div class="step-pane" id="step2">
                                                    
													<h3><strong>Otros Datos</strong></h3>
                                                        <fieldset>
                                                            <div class='row'>
                                                                <div class='col-md-3'><label>{{=form.custom.label.registro_fiscal}}</label></div>
                                                                <div class='col-md-5'>
                                                                    {{=form.custom.widget.registro_fiscal}}
                                                                </div>
                                                            </div>
                                                            <div class='row'>
                                                                <div class='col-md-3'><label>{{=form.custom.label.dir_telefono}}</label></div>
                                                                <div class='col-md-5'>
                                                                    {{=form.custom.widget.dir_telefono}}
                                                                </div>
                                                            </div>
                                                            <div class='row'>
                                                                <div class='col-md-3'><label>{{=form.custom.label.dir_movil}}</label></div>
                                                                <div class='col-md-5'>
                                                                    {{=form.custom.widget.dir_movil}}
                                                                </div>
                                                            </div>
                                                            <div class='row'>
                                                                <div class='col-md-3'><label>{{=form.custom.label.dir_email}}</label></div>
                                                                <div class='col-md-5'>
                                                                    {{=form.custom.widget.dir_email}}
                                                                </div>
                                                            </div>
                                                        </fieldset>
                                                </div>

												<div class="step-pane" id="step3">
													<h3><strong></strong></h3>
													<br>
													<br>
													<h1 class="text-center text-success"><i class="fa fa-check"></i>
                                                    Formulario Listo
													<br>
													<small>Click en Terminar para añadir Empresa</small></h1>
													<br>
													<br>
													<br>
													<br>
												</div>
                                            </form>
										</div>
				
									</div>
									<!-- end widget content -->
				
								</div>
								<!-- end widget div -->
				
							</div>
							<!-- end widget -->
				
						</article>
						<!-- WIDGET END -->
				
					</div>
				
					<!-- end row -->
				
				</section>
				<!-- end widget grid -->

<script src="{{=URL('static','smartadmin/js/app.js')}}"></script>
<script src="{{=URL('static','smartadmin/js/plugin/bootstrap-wizard/jquery.bootstrap.wizard.min.js')}}"></script>
<script src="{{=URL('static','smartadmin/js/plugin/fuelux/wizard/wizard.js')}}"></script>
	
<script type="text/javascript">

    /* Funciones extras añadidas */
    cargarPaises();

    $('#no_table_pais_id').change(function() {
        cargarEstados();
    });

    $('#no_table_estado_id').change(function() {
        cargarMunicipios();
    });

    $('#no_table_municipio_id').change(function() {
        cargarLocalidades();
    });

    /*funciones de validación*/

    /*
    $('#no_table_dir_cp').on('blur keypress', function(){
        var valor = $(this).esCodigoPostal();
        $('.codigo_postal').marcarError(
            'Este no es un código postal válido', valor
        );
    });

    $('#no_table_razon_social').on('blur keypress', function(){
        var valor = $(this).validarCampoObligatorio();
        $('.razon_social').marcarError(
            'Este campo es obligatorio', valor
        );
    });

    $('#no_table_dir_email').on('blur keypress', function(){
        var valor = $(this).esEmail();
        $('.email').marcarError(
            'Este no es un email válido', valor
        );
    });
    */

    function cargarLocalidades() {
        var municipio_id = $('#no_table_municipio_id').val();
        $.post(
            '{{=URL("cargar_localidades")}}', 'municipio_id=' + municipio_id
        ).success(function(data){
            $('#no_table_localidad_id').html(data);
        });
    }

    function cargarMunicipios() {
        var estado_id = $('#no_table_estado_id').val();
        $.post(
            '{{=URL("cargar_municipios")}}', 'estado_id=' + estado_id
        ).success(function(data){
            $('#no_table_municipio_id').html(data);
            cargarLocalidades();
        });
    }

    function cargarEstados() {
        var pais_id = $('#no_table_pais_id').val();
        $.post(
            '{{=URL("cargar_estados")}}', 'pais_id=' + pais_id
        ).success(function(data){
            $('#no_table_estado_id').html(data);
            cargarMunicipios();
        });
    }

    function cargarPaises() {
        $.post(
            '{{=URL("cargar_paises")}}'
        ).success(function(data){
            $('#no_table_pais_id').html(data);
            cargarEstados();
        });
    }

    (function( $ ){
        $.fn.validarCamposVisibles = function() {
            var flag = true;
            $(this).each(function(){
                $(this).find('[id^="no_table_"]').each(function(){
                    if (!$(this).val()) {
                        $(this).css('background', '#fbe3e4');
                        flag = false;
                        console.log('you don\'t pass');
                    }
                });
            });
            return flag;
        };
    })( jQuery );

    /*FIN funciones extras añadidas */
		

// DO NOT REMOVE : GLOBAL FUNCTIONS!
$(document).ready(function() { 

        pageSetUp();	

        //Bootstrap Wizard Validations
        var $validator = $("#wizard-1").validate({

			    rules: {
			      email: {
			        required: true,
			        email: "Your email address must be in the format of name@domain.com"
			      },
			      fname: {
			        required: true
			      },
			      lname: {
			        required: true
			      },
			      country: {
			        required: true
			      },
			      city: {
			        required: true
			      },
			      postal: {
			        required: true,
			        minlength: 4
			      },
			      wphone: {
			        required: true,
			        minlength: 10
			      },
			      hphone: {
			        required: true,
			        minlength: 10
			      }
			    },
			    
			    messages: {
			      fname: "Please specify your First name",
			      lname: "Please specify your Last name",
			      email: {
			        required: "We need your email address to contact you",
			        email: "Your email address must be in the format of name@domain.com"
			      }
			    },
			    
			    highlight: function (element) {
			      $(element).closest('.form-group').removeClass('has-success').addClass('has-error');
			    },
			    unhighlight: function (element) {
			      $(element).closest('.form-group').removeClass('has-error').addClass('has-success');
			    },
			    errorElement: 'span',
			    errorClass: 'help-block',
			    errorPlacement: function (error, element) {
			      if (element.parent('.input-group').length) {
			        error.insertAfter(element.parent());
			      } else {
			        error.insertAfter(element);
			      }
			    }
			  });
			  
			  $('#bootstrap-wizard-1').bootstrapWizard({
			    'tabClass': 'form-wizard',
                'onNext': function (tab, navigation, index) {

                  console.log('cambio');

			      var $valid = $("#wizard-1").valid();
			      if (!$valid) {
			        $validator.focusInvalid();
			        return false;
			      } else {
			        $('#bootstrap-wizard-1').find('.form-wizard').children('li').eq(index - 1).addClass(
			          'complete');
			        $('#bootstrap-wizard-1').find('.form-wizard').children('li').eq(index - 1).find('.step')
			        .html('<i class="fa fa-check"></i>');
			      }
			    }
			  });
            
			  /* fuelux wizard */
			  var wizard = $('.wizard').wizard();
			  
			  wizard.on('finished', function (e, data) {

                $("#empresa").submit();
                var $form = $("#empresa");

                var serializedData = $form.serialize();
                console.log(serializedData);

                /*
                $.ajax({
                    url: "empresa_wizard",
                    type: "post",
                    data: serializedData,
                    success: function(serializedData) {
                        console.log('Inserción exitosa');
                        window.location.url = '{{=URL("", "")}}';
                    },
                    error: function(request, status, error) {
                        console.log('Ocurrió un error al agregar el dato nuevo');
                    }
                });
                */

                /*
			    $.smallBox({
			      title: "Congratulations! Your form was submitted",
			      content: "<i class='fa fa-clock-o'></i> <i>1 seconds ago...</i>",
			      color: "#5F895F",
			      iconSmall: "fa fa-check bounce animated",
			      timeout: 4000
                }); 
                */

			  });
		});



</script>

<style>

.wizard > .content { overflow-y:auto; }

/* útil para evitar la barrita  de navegación */
div.tab-content { overflow: visible; }

.focus-error {
    background: none repeat scroll 0 0 #FBE3E4;
    border: 1px solid #FBC2C4;
}

.unfocus-error {
    background: none repeat scroll 0 0 #FFF;
    border: 1px solid #0000FB;
}
</style>
