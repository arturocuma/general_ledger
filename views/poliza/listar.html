{{extend 'layout.html'}}

<!--script src="//code.jquery.com/jquery-1.11.1.min.js"></script-->
<!--script src="{{=URL('static','js/web2py.js')}}"></script-->

<!--script src="//code.jquery.com/ui/1.11.1/jquery-ui.js"></script>
<link rel="stylesheet" href="//code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css"-->

<!--script src="{{=URL('static', 'js/jeditable/jquery.jeditable.js')}}"></script-->

<script>

/* cuadrar las cuentas */
function cuadrarPoliza() {

    var url = window.location.pathname;
    var cadenitas = url.split('/');

    idPoliza = 'id=' + cadenitas.pop();

    if (cadenitas.pop() == 'asiento.poliza_id') {
        $.post('{{=URL("cuadrar_poliza")}}', idPoliza).success(function(data){
            $('.fila-final').replaceWith(data);
        });
    }
}

$(document).ready(function(){

    cuadrarPoliza();

    /*$('.button').click(function(e) {*/
    $('input[type="submit"]').click(function(e) {
        //e.preventDefault();

        var $form = $('.web2py_form');
        var serializedData = $form.serialize();

        $.each(serializedData.split('&'), function (index, elem) {
            console.log(elem);
        });

    });

    /* Funciones para modificar los valores de los asientos */
    $.getJSON('{{=URL("carga_cc")}}', function(json) {

        var dataArray = [];

        $.each(json, function (index, value) {
            dataArray.push(value);
        });

        $('.cc_empresa_id').editable( "{{=URL('poliza', 'actualiza_descripcion')}}", {
            tooltip: 'Click para editar, ENTER para salvar.',
            indicator: 'Actualizando...',
        }).click(function() {
            $(this).find('input').autocomplete({
                source: dataArray
            });
        });
    });

    $('.concepto_asiento').editable("{{=URL('poliza', 'actualiza_asiento')}}",{
        tooltip: "Click para editar, ENTER para salvar.",
        indicator : "Actualizando...",
    });

    $('.debe').editable("{{=URL('poliza', 'actualiza_asiento')}}",{
        tooltip: "Click para editar, ENTER para salvar.",
        indicator : "Actualizando...",
        callback: function (value, settings) {
            cuadrarPoliza();
        }
    });

    $('.haber').editable("{{=URL('poliza', 'actualiza_asiento')}}",{
        tooltip: "Click para editar, ENTER para salvar.",
        indicator: "Actualizando...",
        callback: function (value, settings) {
            cuadrarPoliza();
        }
    });

    /* Funciones para modificar los valores de las pólizas */
    $('.concepto_general').editable("{{=URL('poliza', 'actualiza_poliza')}}",{
        tooltip: "Click para editar, ENTER para salvar.",
        indicator: "Actualizando...",
    });

    $.getJSON('{{=URL("carga_tipo_poliza")}}', function(json) {

        var dataArray = [];

        $.each(json, function (index, value) {
            dataArray.push(value);
        });

        $('.tipo_poliza').editable("{{=URL('poliza', 'actualiza_tipo_poliza')}}",{
            tooltip: "Click para editar, ENTER para salvar.",
            indicator : "Actualizando...",
        }).click(function() {
            $(this).find('input').autocomplete({
                source: dataArray
            });
        });
    });

});
</script>

<style>

    tr.fila-final td {
        padding: 1.2em 0;
        font-weight: bold;
    }

    .rojo {
        color: red;
    }

    .verde {
        color: green;
    }

</style>

<h1>Pólizas Contables</h1>

{{=polizas}}
