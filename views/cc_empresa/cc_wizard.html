{{extend 'layout.html'}}

<style>

    tr.fila-final td {
        padding: 1.2em 0;
        font-weight: bold;
    }

    .rojo {
        color: red;
    }

    .verde {
        color: green;
    }

</style>

				<!-- widget grid -->
				<section id="widget-grid" class="">
					<!-- row -->
					<div class="row">
						<!-- NEW WIDGET START -->
						<article class="col-sm-12 col-md-12 col-lg-12">
				
							<!-- Widget ID (each widget will need unique ID)-->
							<div class="jarviswidget" id="wid-id-2" data-widget-editbutton="false" data-widget-deletebutton="false">
								<!-- widget options:
								usage: <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false">
				
								data-widget-colorbutton="false"
								data-widget-editbutton="false"
								data-widget-togglebutton="false"
								data-widget-deletebutton="false"
								data-widget-fullscreenbutton="false"
								data-widget-custombutton="false"
								data-widget-collapsed="true"
								data-widget-sortable="false"
				
								-->
								<header>
									<h2>Wizard del Catálogo de Cuentas </h2>
				
								</header>
				
								<!-- widget div-->
								<div>
				
									<!-- widget edit box -->
									<div class="jarviswidget-editbox">
										<!-- This area used as dropdown edit box -->
				
									</div>
									<!-- end widget edit box -->
				
									<!-- widget content -->
									<div class="widget-body fuelux">
				
										<div class="wizard">
											<ul class="steps">
												<li data-target="#step1" class="active">
													<span class="badge badge-info">1</span>Paso 1<span class="chevron"></span>
												</li>
												<li data-target="#step2">
													<span class="badge">2</span>Paso 2<span class="chevron"></span>
												</li>
												<li data-target="#step3">
													<span class="badge">3</span>Paso 3<span class="chevron"></span>
											</ul>
											<div class="actions">
												<button type="button" class="btn btn-sm btn-primary btn-prev">
													<i class="fa fa-arrow-left"></i>Anterior
												</button>
												<button type="button" class="btn btn-sm btn-success btn-next" data-last="Terminar">
													Siguiente<i class="fa fa-arrow-right"></i>
												</button>
											</div>
										</div>
                                        
										<div class="step-content">
				
												<div class="step-pane active" id="step1">
													<h3><strong>Paso 1   </strong> - Catálogo de Cuentas del SAT</h3>
													<div>
                                                       <p>
                                                      Este es un modelo estandar del catálogo de cuentas del SAT, si deseas usarlo en la siguiente sección puedes elegirlo.
                                                      </p>
                                                       {{=cc_empresa}}    
                                                    </div>
												</div>
				
												<div class="step-pane" id="step2">
                                                    
													<h3><strong>Paso 2 </strong> - Pre-configuración del Catálogo de Cuentas</h3>
                                                    
				
													<!-- wizard form starts here -->
                                                    <form class="form-horizontal" id="form-wizard" action="{{=URL('wiz_cc')}}" method="post" enctype="multipart/form-data">
													<fieldset>
                                                        <div>
    Para configurar el catálogo de cuentas debe elegir si utilizará el catálogo de cuentas del SAT mostrado previamente o si lo configurará posteriormente creando todas las cuentas necesarias.
                                        </div><br><br>
                                                        
														<div class="form-group ">
															<label class="col-md-2 control-label">¿Desea utilizar el catálogo de cuentas del SAT? </label>
															<div class="col-md-10">
																<div class="input-group">
                                                                    <select class="" name="cc_preconf" id='cc_sat'>
                                                                         <option value='1'>
                                                                            SI
                                                                        </option>
                                                                        <option value='2'>
                                                                            NO
                                                                        </option>
                                                                    </select>
																</div>
																<span class="help-block"></span>
															</div>
														</div>
                                                       
                                                        <div class="form-group " id="cc_csv" style="display:none;">
															<label class="col-md-2 control-label">Cargar un catálogo de cuentas personalizado </label>
															<div class="col-md-10">
																<div class="input-group">
                                                                    <input class="btn" name="csvfile" id="csvfile" type="file">
																</div>
															</div>
														</div>
                                                       <div class="form-group ">
															<label class="col-md-2 control-label"> </label>
															<div class="col-md-10">
																<div class="input-group">
                                                                    <input type="hidden" name="empresa_id" value="{{=request.vars.empresa_id}}">
                                                                    <input  type="submit" value="Enviar" style="display: none">
                                                                    
																</div>
																
															</div>
														</div>
                                                       
                                                    </fieldset>
                                                    </form>
    </div>

												<div class="step-pane" id="step3">
													<h3><strong>Paso 3 </strong> - ¡Terminado!</h3>
													<br>
													<br>
													<h1 class="text-center text-success"><i class="fa fa-check"></i> ¡Felicidades!
													<br>
													<small>De click en el botón Terminar para finalizar el wizard</small></h1>
													<br>
													<br>
													<br>
													<br>
												</div>
                                                
										
										</div>
				
									</div>
									<!-- end widget content -->
				
								</div>
								<!-- end widget div -->
				
							</div>
							<!-- end widget -->
				
						</article>
						<!-- WIDGET END -->
				
					</div>
				
					<!-- end row -->
				
				</section>
				<!-- end widget grid -->

 <script src="=URL('static','smartadmin/js/app.js')"></script>

		<!-- PAGE RELATED PLUGIN(S) -->
            <script src="{{=URL('static','smartadmin/js/plugin/bootstrap-wizard/jquery.bootstrap.wizard.min.js')}}"></script>
            <script src="{{=URL('static','smartadmin/js/plugin/fuelux/wizard/wizard.js')}}"></script>
	
<script type="text/javascript">
		
		// DO NOT REMOVE : GLOBAL FUNCTIONS!
		
		$(document).ready(function() {
			
			$('#cc_sat').change(function(){
				if( $(this).val() == '1' ){
					$('#cc_csv').hide();
				}
				else{
					$('#cc_csv').show();	
				}
			});

            $('.tree li:has(ul)').addClass('parent_li').find(' > span').attr('title', 'Expandir esta rama');
            var children = $('.tree li.parent_li > span').parent('li.parent_li').find(' > ul > li');
            
            //if (children.is(":visible")) {
            children.hide('fast');
            
           $('.tree li.parent_li > span').attr('title', 'Expandir esta rama').find(' > i').addClass('fa-plus-circle').removeClass('fa-minus-circle');
            //}
    
			pageSetUp();	
	
			//Bootstrap Wizard Validations

			  var $validator = $("#wizard-1").validate({
			    
			    rules: {
			      email: {
			        required: true,
			        email: "Your email address must be in the format of name@domain.com"
			      },
			      fname: {
			        required: true
			      },
			      lname: {
			        required: true
			      },
			      country: {
			        required: true
			      },
			      city: {
			        required: true
			      },
			      postal: {
			        required: true,
			        minlength: 4
			      },
			      wphone: {
			        required: true,
			        minlength: 10
			      },
			      hphone: {
			        required: true,
			        minlength: 10
			      }
			    },
			    
			    messages: {
			      fname: "Please specify your First name",
			      lname: "Please specify your Last name",
			      email: {
			        required: "We need your email address to contact you",
			        email: "Your email address must be in the format of name@domain.com"
			      }
			    },
			    
			    highlight: function (element) {
			      $(element).closest('.form-group').removeClass('has-success').addClass('has-error');
			    },
			    unhighlight: function (element) {
			      $(element).closest('.form-group').removeClass('has-error').addClass('has-success');
			    },
			    errorElement: 'span',
			    errorClass: 'help-block',
			    errorPlacement: function (error, element) {
			      if (element.parent('.input-group').length) {
			        error.insertAfter(element.parent());
			      } else {
			        error.insertAfter(element);
			      }
			    }
			  });
			  
			  $('#bootstrap-wizard-1').bootstrapWizard({
			    'tabClass': 'form-wizard',
			    'onNext': function (tab, navigation, index) {
			      var $valid = $("#wizard-1").valid();
			      if (!$valid) {
			        $validator.focusInvalid();
			        return false;
			      } else {
			        $('#bootstrap-wizard-1').find('.form-wizard').children('li').eq(index - 1).addClass(
			          'complete');
			        $('#bootstrap-wizard-1').find('.form-wizard').children('li').eq(index - 1).find('.step')
			        .html('<i class="fa fa-check"></i>');
			      }
			    }
			  });
            
  $(function (){     
     //Callback handler for form submit event
    function getDoc(frame) {
     var doc = null;
 
     // IE8 cascading access check
     try {
         if (frame.contentWindow) {
             doc = frame.contentWindow.document;
         }
     } catch(err) {
     }
 
     if (doc) { // successful getting content
         return doc;
     }
 
     try { // simply checking may throw in ie8 under ssl or mismatched protocol
         doc = frame.contentDocument ? frame.contentDocument : frame.document;
     } catch(err) {
         // last attempt
         doc = frame.document;
     }
     return doc;
 }
$("#form-wizard").submit(function(e)
{
 
    var formObj = $(this);
    var formURL = formObj.attr("action");
 
    if(window.FormData !== undefined)  // for HTML5 browsers
    {
 
        var formData = new FormData(this);
        $.ajax({
            url: formURL,
            type: 'POST',
            data:  formData,
            mimeType:"multipart/form-data",
            contentType: false,
            cache: false,
            processData:false,
            success: function(data, textStatus, jqXHR)
            {
 
            },
            error: function(jqXHR, textStatus, errorThrown)
            {
 
            }          
       });
        // e.preventDefault();
        //e.unbind();
   }
   else  //for olden browsers
    {
        //generate a random id
        var  iframeId = 'unique' + (new Date().getTime());
 
        //create an empty iframe
        var iframe = $('<iframe src="javascript:false;" name="'+iframeId+'" />');
 
        //hide it
        iframe.hide();
 
        //set form target to iframe
        formObj.attr('target',iframeId);
 
        //Add iframe to body
        iframe.appendTo('body');
        iframe.load(function(e)
        {
            var doc = getDoc(iframe[0]);
            var docRoot = doc.body ? doc.body : doc.documentElement;
            var data = docRoot.innerHTML;
            //data is returned from server.
 
        });
 
    }    
});
      
   $('.tree li.parent_li > span').on('click', function (e) {
            var children = $(this).parent('li.parent_li').find(' > ul > li');
            if (children.is(":visible")) {
                children.hide('fast');
                $(this).attr('title', 'Expandir esta rama').find(' > i').addClass('fa-plus-circle').removeClass('fa-minus-circle');
            } else {
                children.show('fast');
                $(this).attr('title', 'Colapsar esta rama').find(' > i').addClass('fa-minus-circle').removeClass('fa-plus-circle');
            }
            e.stopPropagation();
        });
  });
		
			// fuelux wizard
			  var wizard = $('.wizard').wizard();
			  
			  wizard.on('finished', function (e, data) {
                  
			    //$("#fuelux-wizard").submit();
			    //console.log("submitted!");
			    $.smallBox({
			      title: "Felicidades! Tu formulario se ha enviado",
			      content: "<i class='fa fa-clock-o'></i> <i>hace un minuto...</i>",
			      color: "#5F895F",
			      iconSmall: "fa fa-check bounce animated",
			      timeout: 4000
			    });
                  
                   $( "#form-wizard" ).submit();
			    
			  });

		
		});
        
            </script>
